name: ğŸ® VPS Windows + Sunshine + Moonlight

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360   # VPS cháº¡y tá»‘i Ä‘a 6h

    steps:
    - name: âš™ï¸ Setup User + RDP
      run: |
        # Báº­t RDP Ä‘á»ƒ phÃ²ng trÆ°á»ng há»£p cáº§n
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        net user datlohe Dat@123456 /add
        net localgroup administrators datlohe /add
        Write-Host "âœ… User: datlohe / Password: Dat@123456"

    - name: ğŸŒ CÃ i Sunshine (Game Streaming)
      run: |
        Invoke-WebRequest -Uri "https://github.com/LizardByte/Sunshine/releases/download/v0.23.1/Sunshine-Windows-Installer.exe" -OutFile "Sunshine-Setup.exe"
        Start-Process -FilePath "Sunshine-Setup.exe" -ArgumentList "/quiet" -Wait
        Write-Host "âœ… Sunshine Ä‘Ã£ cÃ i xong!"

        # Má»Ÿ firewall cho Moonlight
        New-NetFirewallRule -DisplayName "Sunshine TCP 47984" -Direction Inbound -Protocol TCP -LocalPort 47984 -Action Allow
        New-NetFirewallRule -DisplayName "Sunshine TCP 47989" -Direction Inbound -Protocol TCP -LocalPort 47989 -Action Allow
        New-NetFirewallRule -DisplayName "Sunshine UDP 48010" -Direction Inbound -Protocol UDP -LocalPort 48010 -Action Allow

    - name: â˜ï¸ CÃ i Cloudflared
      run: |
        Invoke-WebRequest https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe -OutFile cloudflared.exe
        Write-Host "âœ… Cloudflared táº£i xong!"

        # Táº¡o tunnel cho Sunshine (47984 TCP)
        Start-Process -FilePath ".\cloudflared.exe" -ArgumentList "tunnel --url tcp://localhost:47984" -NoNewWindow

        Start-Sleep -Seconds 15
        Write-Host "============================"
        Write-Host "ğŸŒ VPS sáºµn sÃ ng!"
        Write-Host "ğŸ‘¤ User: datlohe"
        Write-Host "ğŸ”‘ Password: Dat@123456"
        Write-Host "ğŸ‘‰ Má»Ÿ Moonlight, thÃªm server vá»›i link hiá»ƒn thá»‹ trong log Cloudflared á»Ÿ trÃªn"
        Write-Host "============================"

    - name: â³ Giá»¯ VPS cháº¡y
      run: |
        while ($true) { Start-Sleep -Seconds 60 }
